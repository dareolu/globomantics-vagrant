---

- name: Set up the working directory for consul servers
  file:
    path: "{{ item }}"
    state: directory
  with_items:
    - "{{ working_dir }}"
    - "{{ working_dir }}/provision"

- name: Build the provisioning environment for Vagrant (Consul)
  template:
      src: "{{ item.src }}"
      dest: "{{ item.dest }}"
  with_items:
    - {src: "setup-ansible.sh.j2" , dest: "{{ working_dir }}/provision/setup-ansible.sh"}
    - {src: "setup-consul.sh.j2" , dest: "{{ working_dir }}/provision/setup-consul.sh"}
    - {src: "setup-docker.sh.j2" , dest: "{{ working_dir }}/provision/setup-docker.sh"}
    - {src: "setup-kubectl.sh.j2" , dest: "{{ working_dir }}/provision/setup-kubectl.sh"}

- name: Create the Vagrant File for a DR Solution (Consul)
  template:
      src: "doubleDCvagrantfile.j2"
      dest: "{{ working_dir }}/Vagrantfile"
  when: dc_deploy_type == "dr"

- name: Create the Vagrant File for a Single DC Solution (Consul)
  template:
      src: "singleDCvagrantfile.j2"
      dest: "{{ working_dir }}/Vagrantfile"
  when: dc_deploy_type == "single"
